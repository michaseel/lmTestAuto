<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Canvas Confetti CDN for animations -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Custom styles for subtle transitions */
        .kanban-card {
            transition: all 0.3s ease-in-out;
            transform: translateY(0);
        }
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .kanban-column {
            transition: background-color 0.3s ease;
        }
        /* Vibrant color scheme overrides for Tailwind */
        .column-backlog { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .column-progress { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .column-review { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .column-done { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 via-blue-100 to-pink-100 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">My Vibrant Kanban Board</h1>
        <div id="kanban-board" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Columns will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // Namespace for localStorage to avoid conflicts
        const STORAGE_KEY = 'my-kanban-board-v1';

        // Data structure: Array of card objects
        let cards = [];

        // Column configurations
        const columns = [
            { id: 'backlog', title: 'Backlog', color: 'column-backlog' },
            { id: 'progress', title: 'In Progress', color: 'column-progress' },
            { id: 'review', title: 'Review', color: 'column-review' },
            { id: 'done', title: 'Done', color: 'column-done' }
        ];

        // Generate unique ID for cards
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Load cards from localStorage
        function loadCards() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                cards = JSON.parse(stored);
            } else {
                // Initialize with dummy cards if none exist
                cards = [
                    { id: generateId(), content: 'Research new UI framework', column: 'backlog' },
                    { id: generateId(), content: 'Design wireframes', column: 'backlog' },
                    { id: generateId(), content: 'Implement drag and drop', column: 'progress' },
                    { id: generateId(), content: 'Fix login bug', column: 'progress' },
                    { id: generateId(), content: 'Code review for auth module', column: 'review' },
                    { id: generateId(), content: 'Test edge cases', column: 'review' },
                    { id: generateId(), content: 'Deploy to staging', column: 'done' },
                    { id: generateId(), content: 'Write documentation', column: 'done' }
                ];
                saveCards();
            }
            return cards;
        }

        // Save cards to localStorage
        function saveCards() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
        }

        // Find a card by ID
        function findCard(id) {
            return cards.find(card => card.id === id);
        }

        // Update card in array and storage
        function updateCard(updatedCard) {
            const index = cards.findIndex(card => card.id === updatedCard.id);
            if (index !== -1) {
                cards[index] = updatedCard;
                saveCards();
            }
        }

        // Remove card from array and storage
        function removeCard(id) {
            cards = cards.filter(card => card.id !== id);
            saveCards();
        }

        // Move card to new column
        function moveCard(cardId, newColumn) {
            const card = findCard(cardId);
            if (card) {
                card.column = newColumn;
                saveCards();
                // Trigger confetti if moving to 'done'
                if (newColumn === 'done') {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            }
        }

        // Create DOM element for a card
        function createCardElement(card) {
            const cardEl = document.createElement('div');
            cardEl.className = 'kanban-card bg-white rounded-lg shadow-md p-4 mb-3 cursor-move relative group';
            cardEl.draggable = true;
            cardEl.dataset.id = card.id;
            cardEl.contentEditable = false; // Initially not editable
            cardEl.textContent = card.content;

            // Edit functionality: Double-click to edit
            cardEl.addEventListener('dblclick', (e) => {
                cardEl.contentEditable = true;
                cardEl.focus();
                // Style for editing
                cardEl.classList.add('border-2', 'border-blue-500', 'bg-yellow-50');
            });

            // Save on blur
            cardEl.addEventListener('blur', (e) => {
                if (cardEl.contentEditable) {
                    cardEl.contentEditable = false;
                    cardEl.classList.remove('border-2', 'border-blue-500', 'bg-yellow-50');
                    const newContent = cardEl.textContent.trim();
                    if (newContent && newContent !== card.content) {
                        updateCard({ ...card, content: newContent });
                    }
                }
            });

            // Prevent drag when editing
            cardEl.addEventListener('dragstart', (e) => {
                if (cardEl.contentEditable) {
                    e.preventDefault();
                    return false;
                }
            });

            // Drag events for the card
            cardEl.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', card.id);
                cardEl.classList.add('opacity-50');
            });

            cardEl.addEventListener('dragend', (e) => {
                cardEl.classList.remove('opacity-50');
            });

            // Delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'absolute top-2 right-2 opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs transition-opacity';
            deleteBtn.innerHTML = 'Ã—';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (confirm(`Delete "${card.content}"?`)) { // Using confirm for delete confirmation as specified
                    removeCard(card.id);
                    render();
                }
            });
            cardEl.appendChild(deleteBtn);

            return cardEl;
        }

        // Create DOM element for a column
        function createColumnElement(column) {
            const colEl = document.createElement('div');
            colEl.className = `kanban-column ${column.color} rounded-xl p-6 min-h-[400px] flex flex-col shadow-lg`;
            colEl.dataset.column = column.id;
            colEl.addEventListener('dragover', (e) => {
                e.preventDefault(); // Allow drop
            });
            colEl.addEventListener('drop', (e) => {
                e.preventDefault();
                const cardId = e.dataTransfer.getData('text/plain');
                moveCard(cardId, column.id);
                render(); // Re-render to update positions
            });

            // Header
            const header = document.createElement('div');
            header.className = 'flex justify-between items-center mb-4';
            const title = document.createElement('h2');
            title.className = 'text-xl font-bold text-white';
            title.textContent = column.title;
            header.appendChild(title);

            // Add card button
            const addBtn = document.createElement('button');
            addBtn.className = 'bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium hover:bg-gray-100 transition-colors';
            addBtn.innerHTML = '+ Add Card';
            addBtn.addEventListener('click', () => {
                // Create input for adding card without prompt
                const inputContainer = document.createElement('div');
                inputContainer.className = 'mb-3 p-2 bg-white/20 rounded';
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Enter card title...';
                input.className = 'w-full p-2 rounded text-black outline-none';
                const saveBtn = document.createElement('button');
                saveBtn.className = 'ml-2 bg-green-500 text-white px-3 py-1 rounded text-sm';
                saveBtn.textContent = 'Add';
                saveBtn.addEventListener('click', () => {
                    const content = input.value.trim();
                    if (content) {
                        const newCard = { id: generateId(), content, column: column.id };
                        cards.push(newCard);
                        saveCards();
                        render();
                    }
                });
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') saveBtn.click();
                });
                inputContainer.appendChild(input);
                inputContainer.appendChild(saveBtn);
                colEl.insertBefore(inputContainer, colEl.firstChild.nextSibling); // Insert after header
                input.focus();
                // Auto-remove input after add or on escape
                const removeInput = () => {
                    if (inputContainer.parentNode) {
                        colEl.removeChild(inputContainer);
                    }
                };
                input.addEventListener('blur', removeInput);
                saveBtn.addEventListener('click', removeInput);
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') removeInput();
                });
            });
            header.appendChild(addBtn);
            colEl.appendChild(header);

            // Cards container
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'flex-1 space-y-3 overflow-y-auto';
            colEl.appendChild(cardsContainer);

            return colEl;
        }

        // Render the entire board
        function render() {
            const board = document.getElementById('kanban-board');
            board.innerHTML = ''; // Clear existing

            // Create columns
            columns.forEach(column => {
                const colEl = createColumnElement(column);
                const cardsContainer = colEl.querySelector('div.flex-1'); // Last child is cards container

                // Add cards to this column
                const columnCards = cards.filter(card => card.column === column.id);
                columnCards.forEach(card => {
                    cardsContainer.appendChild(createCardElement(card));
                });

                board.appendChild(colEl);
            });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadCards();
            render();
        });
    </script>
</body>
</html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vanilla Kanban Board</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* ---- Simple confetti animation ---- */
  @keyframes confetti-fall {
    0%   { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
  }
  .confetti-piece {
    position: fixed;
    width: 8px; height: 8px;
    background: var(--confetti-color, #ff6b6b);
    border-radius: 50%;
    animation: confetti-fall 1.2s linear forwards;
    pointer-events: none;
  }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white min-h-screen flex items-center justify-center p-4">
<div class="max-w-4xl w-full space-y-6">

  <!-- Title -->
  <h1 class="text-center text-4xl font-extrabold bg-clip-text text-transparent bg-radial-gradient-to-r (radial-gradient(circle at 30% 30%, #ff9a9e, #fad0c4)) md:text-5xl md:tracking-wider">
    Kanban Board
  </h1>

  <!-- Board Container -->
  <div id="board" class="grid grid-cols-1 md:grid-cols-4 gap-4">

    <!-- Column Template (cloned for each column) -->
    <div class="col-span-1 bg-white rounded-xl shadow-lg p-4 flex flex-col h-full">
      <h2 class="text-lg font-semibold mb-2 flex items-center justify-between">
        <span class="flex-1">Backlog</span>
        <button id="add-backlog" class="text-green-600 hover:text-green-900">+ Add</button>
      </h2>
      <div class="flex-1 overflow-y-auto card-list" data-col="backlog"></div>
    </div>

    <div class="col-span-1 bg-white rounded-xl shadow-lg p-4 flex flex-col h-full">
      <h2 class="text-lg font-semibold mb-2 flex items-center justify-between">
        <span class="flex-1">In Progress</span>
        <button id="add-inprogress" class="text-blue-600 hover:text-blue-900">+ Add</button>
      </h2>
      <div class="flex-1 overflow-y-auto card-list" data-col="inprogress"></div>
    </div>

    <div class="col-span-1 bg-white rounded-xl shadow-lg p-4 flex flex-col h-full">
      <h2 class="text-lg font-semibold mb-2 flex items-center justify-between">
        <span class="flex-1">Review</span>
        <button id="add-review" class="text-yellow-600 hover:text-yellow-900">+ Add</button>
      </h2>
      <div class="flex-1 overflow-y-auto card-list" data-col="review"></div>
    </div>

    <div class="col-span-1 bg-white rounded-xl shadow-lg p-4 flex flex-col h-full">
      <h2 class="text-lg font-semibold mb-2 flex items-center justify-between">
        <span class="flex-1">Done</span>
        <button id="add-done" class="text-indigo-600 hover:text-indigo-900">+ Add</button>
      </h2>
      <div class="flex-1 overflow-y-auto card-list" data-col="done"></div>
    </div>

  </div>
</div>

<!-- ---- Confirmation Modal (custom, no alert/prompt) ---- -->
<div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl p-6 w-96 max-w-md mx-4">
    <h3 class="text-lg font-medium mb-2 text-center">Delete Card?</h3>
    <p class="mb-4 text-center">Are you sure you want to delete this card?</p>
    <div class="flex justify-end space-x-2">
      <button id="confirm-yes" class="px-4 py-2 bg-red-600 text-white rounded">Yes</button>
      <button id="confirm-no" class="px-4 py-2 bg-gray-600 text-white rounded">No</button>
    </div>
  </div>
</div>

<!-- ---- Confetti Container (hidden until needed) ---- -->
<div id="confetti-container" class="fixed inset-0 pointer-events-none"></div>

<script>
/* ==============================================================
   Kanban Board – Vanilla JavaScript
   ============================================================== */

/* ---------- 1. Constants & State ---------- */
const NAMESPACE = 'myKanbanApp';               // localStorage namespace
const STORAGE_KEY = `${NAMESPACE}-data`;       // full key name
const COLUMNS = ['backlog', 'inprogress', 'review', 'done']; // order matters
const DUMMY_CARDS = {
  backlog: [
    {id: crypto.randomUUID(), text: 'Implement auth'},
    {id: crypto.randomUUID(), text: 'Design DB schema'},
    {id: crypto.randomUUID(), text: 'Write unit tests'}
  ],
  inprogress: [
    {id: crypto.randomUUID(), text: 'Create UI components'},
    {id: crypto.randomUUID(), text: 'Set up CI pipeline'}
  ],
  review: [],
  done: []
};

/* ---------- 2. Helper Functions ---------- */

/**
 * Load persisted data from localStorage or initialise with dummy data.
 * Returns an object mapping column id → array of card objects.
 */
function loadState() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (raw) {
    try {
      const parsed = JSON.parse(raw);
      // Ensure all columns exist
      COLUMNS.forEach(col => {
        if (!parsed[col] || !Array.isArray(parsed[col])) parsed[col] = [];
      });
      return parsed;
    } catch (_) { /* fall through */ }
  }
  // No valid data → return dummy state
  return {...DUMMY_CARDS};
}

/**
 * Persist the current state to localStorage.
 * @param {Object} state
 */
function saveState(state) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/**
 * Generate a unique string id for a card.
 */
function genId() {
  return crypto.randomUUID();
}

/**
 * Create a DOM element representing a card.
 * @param {Object} card - {id, text}
 * @param {string} colId - column id (used for drag‑data)
 * @returns {HTMLElement}
 */
function createCardElement(card, colId) {
  const cardDiv = document.createElement('div');
  cardDiv.className =
    'flex flex-col bg-gray-100 dark:bg-gray-800 rounded-lg p-3 mb-2 shadow-sm transition-all duration-200';
  cardDiv.dataset.id = card.id;
  cardDiv.dataset.col = colId;

  // Editable text area (contenteditable)
  const textDiv = document.createElement('div');
  textDiv.contentEditable = true;
  textDiv.className = 'flex-1 text-sm text-gray-900 dark:text-gray-100 mb-1';
  textDiv.textContent = card.text;
  textDiv.setAttribute('data-type', 'card-text');
  textDiv.setAttribute('tabindex', '0'); // make focusable

  // Delete button
  const delBtn = document.createElement('button');
  delBtn.type = 'button';
  delBtn.className = 'self-end text-red-600 hover:text-red-900 text-xs';
  delBtn.innerHTML = '✕';
  delBtn.dataset.cardId = card.id;
  delBtn.title = 'Delete card';

  // Assemble
  cardDiv.appendChild(textDiv);
  cardDiv.appendChild(delBtn);
  return cardDiv;
}

/**
 * Show the custom confirmation modal.
 * @param {HTMLElement} cardEl - the card that will be deleted
 */
function showConfirmModal(cardEl) {
  const modal = document.getElementById('confirm-modal');
  const yesBtn = document.getElementById('confirm-yes');
  const noBtn = document.getElementById('confirm-no');

  // Store reference for later use
  modal.dataset.targetCard = cardEl.dataset.id;

  modal.classList.remove('hidden');
}

/**
 * Trigger a short confetti burst.
 */
function triggerConfetti() {
  const container = document.getElementById('confetti-container');
  const colors = ['#ff6b6b', '#ffb86c', '#feca57', '#8892b0', '#74b9ff'];
  for (let i = 0; i < 20; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + 'vw';
    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
    piece.style.animationDelay = Math.random() * 1s + 's';
    piece.style.transform = `translateY(0) rotate(${Math.random() * 360}deg)`;
    container.appendChild(piece);
    // Remove after animation ends
    piece.addEventListener('animationend', () => piece.remove());
  }
}

/* ---------- 3. Rendering ---------- */
function renderBoard() {
  const state = loadState(); // we only need it for initial load; later we manipulate DOM directly
  const board = document.getElementById('board');

  // Ensure each column container exists (they are static in HTML)
  COLUMNS.forEach(col => {
    const colEl = board.querySelector(`[data-col="${col}"]`);
    colEl.innerHTML = ''; // clear any previous cards

    // Add existing cards
    state[col].forEach(card => {
      const cardEl = createCardElement(card, col);
      colEl.appendChild(cardEl);
    });
  });
}

/* ---------- 4. Drag‑and‑Drop Logic ---------- */
let draggedCard = null;

/**
 * Start drag operation.
 */
function onDragStart(e) {
  draggedCard = this; // `this` is the card element
  e.dataTransfer.setData('text/plain', this.dataset.id);
  // Visual cue
  this.classList.add('opacity-50');
}

/**
 * Allow drop.
 */
function onDragOver(e) {
  e.preventDefault(); // necessary to allow drop
}

/**
 * Handle drop – move card to new column.
 */
function onDrop(e) {
  e.preventDefault();
  const target = this; // column container
  const cardId = e.dataTransfer.getData('text/plain');

  // Find the dragged card element
  const dragged = document.querySelector(`[data-id="${cardId}"]`);
  if (!dragged || dragged === draggedCard) return;

  // Remove from old column
  const oldCol = dragged.dataset.col;
  const newCol = target.dataset.col;
  if (oldCol === newCol) return; // same column – nothing to do

  // Update DOM
  target.appendChild(dragged);

  // Persist change
  const state = loadState();
  // Remove from old column array
  state[oldCol] = state[oldCol].filter(c => c.id !== cardId);
  // Add to new column array
  state[newCol].push({id: cardId, text: dragged.querySelector('[contenteditable]').textContent.trim()});
  saveState(state);

  // If moved to "Done", trigger confetti
  if (newCol === 'done') triggerConfetti();

  // Re‑attach edit listeners (delegated)
  attachEditListeners();
}

/* ---------- 5. Edit Handling (in‑place) ---------- */
function attachEditListeners() {
  // 1) Double‑click to keep editing (already editable via contenteditable)
  // 2) On blur → save
  document.querySelectorAll('[contenteditable]').forEach(el => {
    el.addEventListener('blur', onEditBlur);
    el.addEventListener('keypress', e => {
      if (e.key === 'Enter') e.preventDefault(), el.blur();
    });
  });

  // 3) Delete button click → show confirmation
  document.querySelectorAll('[data-card-id]').forEach(btn => {
    btn.addEventListener('click', onDeleteClick);
  });
}

/**
 * Save edited card text.
 */
function onEditBlur(e) {
  const el = e.target;
  const newText = el.textContent.trim();
  if (!newText) {
    // If empty, delete the card
    el.parentElement.remove();
    const state = loadState();
    const colId = el.parentElement.dataset.col;
    state[colId] = state[colId].filter(c => c.id !== el.dataset.id);
    saveState(state);
    return;
  }
  const state = loadState();
  const idx = state[el.parentElement.dataset.col].findIndex(c => c.id === el.dataset.id);
  if (idx > -1) {
    state[el.parentElement.dataset.col][idx].text = newText;
    saveState(state);
  }
}

/**
 * Delete button click handler.
 */
function onDeleteClick(e) {
  showConfirmModal(e.target.closest('.card'));
}

/**
 * Confirmation modal button actions.
 */
document.getElementById('confirm-yes').addEventListener('click', () => {
  const targetId = document.getElementById('confirm-modal').dataset.targetCard;
  const cardEl = document.querySelector(`[data-id="${targetId}"]`);
  if (cardEl) cardEl.remove();

  // Update storage
  const state = loadState();
  COLUMNS.forEach(col => {
    state[col] = state[col].filter(c => c.id !== targetId);
  });
  saveState(state);
  document.getElementById('confirm-modal').classList.add('hidden');
});
document.getElementById('confirm-no').addEventListener('click', () => {
  document.getElementById('confirm-modal').classList.add('hidden');
});

/* ---------- 6. Add Card Logic ---------- */
function createAddInput(colId) {
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = `Add a card to ${colId.replace(/([a-z])([A-Z])/g, '$1 $2').toLowerCase()}`;
  input.className = 'w-full px-3 py-2 rounded bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500';
  input.dataset.col = colId;
  input.addEventListener('keypress', e => {
    if (e.key === 'Enter' && input.value.trim()) {
      addCardToColumn(colId, input.value.trim());
      input.value = '';
    }
  });
  return input;
}

/**
 * Append a new card to a column.
 * @param {string} colId
 * @param {string} text
 */
function addCardToColumn(colId, text) {
  const state = loadState();
  const newCard = {id: genId(), text};
  state[colId].push(newCard);
  saveState(state);
  // Render immediately
  const colEl = document.querySelector(`[data-col="${colId}"]`);
  const cardEl = createCardElement(newCard, colId);
  colEl.appendChild(cardEl);
  attachEditListeners(); // re‑attach newly added card listeners
}

/* ---------- 7. Initialise ---------- */
document.addEventListener('DOMContentLoaded', () => {
  // Render initial board (dummy cards if needed)
  renderBoard();

  // Attach drag‑and‑drop listeners to each card
  document.querySelectorAll('.card').forEach(card => {
    card.draggable = true;
    card.addEventListener('dragstart', onDragStart);
    card.addEventListener('dragover', onDragOver);
    card.addEventListener('drop', onDrop);
  });

  // Attach generic listeners
  attachEditListeners();

  // Wire up “Add Card” buttons per column
  COLUMNS.forEach(col => {
    const btnId = `add-${col}`;
    document.getElementById(btnId).addEventListener('click', () => {
      const input = createAddInput(col);
      const colEl = document.querySelector(`[data-col="${col}"]`);
      colEl.prepend(input);
      input.focus();
    });
  });
});
</script>
</body>
</html>
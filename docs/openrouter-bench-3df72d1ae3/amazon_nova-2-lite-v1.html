<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kanban Board</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.2.12/dist/confetti.min.js"></script>
  <style>
    /* Custom styles for drag and drop and transitions */
    .kanban-column {
      min-width: 280px;
      transition: background-color 0.3s ease;
    }
    .kanban-column.dragging-over {
      background-color: #f0f9ff;
    }
    .kanban-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .kanban-card:active {
      transform: scale(1.02);
    }
    .kanban-card.dragging {
      opacity: 0.5;
    }
    .edit-input {
      padding: 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen p-4 font-sans antialiased">
  <div class="max-w-7xl mx-auto">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-2">✨ Kanban Board ✨</h1>
      <p class="text-gray-600">Drag, edit, and manage your tasks with ease</p>
    </header>

    <div id="kanban-board" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
  </div>

  <script>
    // Namespace for localStorage to avoid conflicts
    const KANBAN_NAMESPACE = 'kanban-board-v1';

    // Initial columns configuration
    const columnsData = [
      { id: 'backlog', title: 'Backlog', cardCount: 0 },
      { id: 'in-progress', title: 'In Progress', cardCount: 0 },
      { id: 'review', title: 'Review', cardCount: 0 },
      { id: 'done', title: 'Done', cardCount: 0 }
    ];

    // Initialize the board when the DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved state from localStorage or initialize with dummy data
      const savedState = JSON.parse(localStorage.getItem(KANBAN_NAMESPACE) || null);
      const initialCards = savedState ? savedState : generateDummyCards();

      // Render the Kanban board with columns and cards
      renderBoard(initialCards);

      // Attach event listeners for card creation
      document.querySelectorAll('.add-card-btn').forEach(btn => {
        btn.addEventListener('click', handleAddCard);
      });
    });

    /**
     * Generates dummy cards for initial board state
     * @returns {Object} An object with columns and their associated cards
     */
    function generateDummyCards() {
      return {
        'backlog': [
          { id: crypto.randomUUID(), title: 'Setup project structure', description: 'Initialize repo and basic files' },
          { id: crypto.randomUUID(), title: 'Design system', description: 'Create UI components and theme' }
        ],
        'in-progress': [
          { id: crypto.randomUUID(), title: 'Implement authentication', description: 'User login and registration flow' }
        ],
        'review': [
          { id: crypto.randomUUID(), title: 'Code review for auth module', description: 'Review PRs for authentication logic' }
        ],
        'done': [
          { id: crypto.randomUUID(), title: 'Project planning', description: 'Define MVP and milestones' }
        ]
      };
    }

    /**
     * Renders the entire Kanban board with columns and cards
     * @param {Object} cards - Object containing cards organized by column
     */
    function renderBoard(cards) {
      const board = document.getElementById('kanban-board');
      board.innerHTML = '';

      columnsData.forEach(column => {
        const columnEl = document.createElement('div');
        columnEl.className = 'kanban-column bg-white rounded-lg shadow-sm p-4 flex flex-col';
        columnEl.dataset.columnId = column.id;

        // Column header with title and count
        const header = document.createElement('div');
        header.className = 'flex justify-between items-center mb-3';
        header.innerHTML = `
          <h2 class="text-lg font-semibold text-${column.id === 'done' ? 'green' : 'gray'}-700">${column.title}</h2>
          <span class="bg-${column.id === 'done' ? 'green' : 'blue'}-100 text-${column.id === 'done' ? 'green' : 'blue'}-700 px-2 py-1 rounded-full text-sm">${cards[column.id]?.length || 0}</span>
        `;
        columnEl.appendChild(header);

        // Container for cards in this column
        const cardList = document.createElement('div');
        cardList.className = 'flex-1 space-y-3 min-h-[200px]';
        columnEl.appendChild(cardList);

        // Render cards for this column
        if (cards[column.id]) {
          cards[column.id].forEach(card => {
            cardList.appendChild(createCardElement(card, column.id));
          });
        }

        // Add card button
        const addBtn = document.createElement('button');
        addBtn.className = 'add-card-btn w-full mt-2 px-3 py-2 border border-dashed border-gray-300 rounded-lg text-gray-500 hover:text-gray-700 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 text-sm';
        addBtn.innerHTML = '+ Add card';
        addBtn.dataset.columnId = column.id;
        columnEl.appendChild(addBtn);

        board.appendChild(columnEl);
      });

      // Attach drag and drop event listeners after rendering
      setupDragAndDrop();
    }

    /**
     * Creates a card element with edit and delete functionality
     * @param {Object} card - The card data
     * @param {string} columnId - The ID of the column the card belongs to
     * @returns {HTMLElement} The created card element
     */
    function createCardElement(card, columnId) {
      const cardEl = document.createElement('div');
      cardEl.className = 'kanban-card bg-white border border-gray-200 rounded-lg shadow-sm p-3 cursor-pointer';
      cardEl.dataset.cardId = card.id;
      cardEl.dataset.columnId = columnId;

      // Card content
      cardEl.innerHTML = `
        <div class="flex justify-between items-start">
          <h3 class="font-medium text-gray-900">${card.title}</h3>
          <div class="flex space-x-1">
            <button class="edit-card-btn p-1 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M12.146.146a.5.5 0 0 1 .707 0l3 3a.5.5 0 0 1 0 .707l-3 3a.5.5 0 0 1-.707-.707L14.793 4H3.5a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5h11.293zM5.5 9a.5.5 0 0 1 .5-.5h-.002a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5h-6a.5.5 0 0 1-.5-.5V9a.5.5 0 0 1 .5-.5h6z"/>
              </svg>
            </button>
            <button class="delete-card-btn p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M.165 2.678a.5.5 0 0 1 .869-.494l14.995 14.995a.5.5 0 0 1-.707.707L.17 3.385a.5.5 0 0 1 .494-.707zM14.5 2a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-1 0V2.5a.5.5 0 0 1 .5-.5zM4.886 6.217a.5.5 0 0 1 .061.763L1.793 10.5a.5.5 0 0 1-.762-.06L4.124 5.656a.5.5 0 0 1 .762.561zM8.046 9.5a.5.5 0 0 1 .5-.5v-3a.5.5 0 0 1 1 0v3a.5.5 0 0 1-.5.5z"/>
              </svg>
            </button>
          </div>
        </div>
        ${card.description ? `<p class="mt-2 text-sm text-gray-600">${card.description}</p>` : ''}
      `;

      // Edit button handler
      cardEl.querySelector('.edit-card-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        showEditModal(card, columnId);
      });

      // Delete button handler with confirmation
      cardEl.querySelector('.delete-card-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        if (confirm('Are you sure you want to delete this card?')) {
          deleteCard(card.id, columnId);
        }
      });

      return cardEl;
    }

    /**
     * Sets up drag and drop functionality for cards
     */
    function setupDragAndDrop() {
      const cards = document.querySelectorAll('.kanban-card');
      const columns = document.querySelectorAll('.kanban-column');

      cards.forEach(card => {
        card.draggable = true;

        card.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', card.dataset.cardId);
          card.classList.add('dragging');
        });

        card.addEventListener('dragend', () => {
          card.classList.remove('dragging');
        });
      });

      columns.forEach(column => {
        column.addEventListener('dragover', (e) => {
          e.preventDefault();
          column.classList.add('dragging-over');
        });

        column.addEventListener('dragleave', () => {
          column.classList.remove('dragging-over');
        });

        column.addEventListener('drop', (e) => {
          e.preventDefault();
          column.classList.remove('dragging-over');

          const cardId = e.dataTransfer.getData('text/plain');
          const sourceColumnId = document.querySelector(`.kanban-card[data-card-id="${cardId}"]`).dataset.columnId;
          const targetColumnId = column.dataset.columnId;

          if (sourceColumnId !== targetColumnId) {
            moveCard(cardId, sourceColumnId, targetColumnId);
          }
        });
      });
    }

    /**
     * Moves a card from one column to another
     * @param {string} cardId - The ID of the card to move
     * @param {string} sourceColumnId - The ID of the source column
     * @param {string} targetColumnId - The ID of the target column
     */
    function moveCard(cardId, sourceColumnId, targetColumnId) {
      // Load current state
      const boardState = JSON.parse(localStorage.getItem(KANBAN_NAMESPACE) || null) || {};

      // Move card from source to target column
      const card = boardState[sourceColumnId].find(c => c.id === cardId);
      if (card) {
        // Remove from source
        boardState[sourceColumnId] = boardState[sourceColumnId].filter(c => c.id !== cardId);
        // Add to target
        if (!boardState[targetColumnId]) boardState[targetColumnId] = [];
        boardState[targetColumnId].push(card);

        // Save updated state
        localStorage.setItem(KANBAN_NAMESPACE, JSON.stringify(boardState));

        // Update UI
        renderBoard(boardState);

        // Trigger confetti animation if moving to Done
        if (targetColumnId === 'done') {
          triggerConfetti();
        }
      }
    }

    /**
     * Deletes a card from its current column
     * @param {string} cardId - The ID of the card to delete
     * @param {string} columnId - The ID of the column containing the card
     */
    function deleteCard(cardId, columnId) {
      const boardState = JSON.parse(localStorage.getItem(KANBAN_NAMESPACE) || null) || {};

      // Remove card from column
      boardState[columnId] = boardState[columnId].filter(c => c.id !== cardId);

      // Save updated state
      localStorage.setItem(KANBAN_NAMESPACE, JSON.stringify(boardState));

      // Update UI
      renderBoard(boardState);
    }

    /**
     * Handles adding a new card to a column
     * @param {Event} e - The click event
     */
    function handleAddCard(e) {
      const columnId = e.target.dataset.columnId;
      showAddCardModal(columnId);
    }

    /**
     * Shows modal for adding a new card
     * @param {string} columnId - The ID of the column to add to
     */
    function showAddCardModal(columnId) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Card</h3>
          <form id="add-card-form">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
              <input type="text" id="new-card-title" required class="edit-input w-full">
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Description (optional)</label>
              <textarea id="new-card-description" class="edit-input w-full resize-none h-20"></textarea>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="button" id="cancel-add" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
              <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Add</button>
            </div>
          </form>
        </div>
      `;

      document.body.appendChild(modal);

      // Handle form submission
      modal.querySelector('#add-card-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const title = modal.querySelector('#new-card-title').value.trim();
        const description = modal.querySelector('#new-card-description').value.trim();

        if (title) {
          addCard(columnId, { id: crypto.randomUUID(), title, description });
          modal.remove();
        }
      });

      // Handle cancel
      modal.querySelector('#cancel-add').addEventListener('click', () => modal.remove());
    }

    /**
     * Shows modal for editing an existing card
     * @param {Object} card - The card to edit
     * @param {string} columnId - The ID of the column containing the card
     */
    function showEditModal(card, columnId) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
          <h3 class="text-lg font-semibold mb-4">Edit Card</h3>
          <form id="edit-card-form">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
              <input type="text" id="edit-card-title" required value="${card.title}" class="edit-input w-full">
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea id="edit-card-description" class="edit-input w-full resize-none h-20">${card.description || ''}</textarea>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="button" id="cancel-edit" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
              <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save</button>
            </div>
          </form>
        </div>
      `;

      document.body.appendChild(modal);

      // Handle form submission
      modal.querySelector('#edit-card-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const title = modal.querySelector('#edit-card-title').value.trim();
        const description = modal.querySelector('#edit-card-description').value.trim();

        if (title) {
          updateCard(card.id, columnId, { title, description });
          modal.remove();
        }
      });

      // Handle cancel
      modal.querySelector('#cancel-edit').addEventListener('click', () => modal.remove());
    }

    /**
     * Adds a new card to a column
     * @param {string} columnId - The ID of the column to add to
     * @param {Object} card - The card data
     */
    function addCard(columnId, card) {
      const boardState = JSON.parse(localStorage.getItem(KANBAN_NAMESPACE) || null) || {};

      // Initialize column if it doesn't exist
      if (!boardState[columnId]) boardState[columnId] = [];

      // Add new card
      boardState[columnId].push(card);

      // Save updated state
      localStorage.setItem(KANBAN_NAMESPACE, JSON.stringify(boardState));

      // Update UI
      renderBoard(boardState);
    }

    /**
     * Updates an existing card's data
     * @param {string} cardId - The ID of the card to update
     * @param {string} columnId - The ID of the column containing the card
     * @param {Object} updates - The updates to apply to the card
     */
    function updateCard(cardId, columnId, updates) {
      const boardState = JSON.parse(localStorage.getItem(KANBAN_NAMESPACE) || null) || {};

      // Find and update card
      if (boardState[columnId]) {
        boardState[columnId] = boardState[columnId].map(c => 
          c.id === cardId ? { ...c, ...updates } : c
        );

        // Save updated state
        localStorage.setItem(KANBAN_NAMESPACE, JSON.stringify(boardState));

        // Update UI
        renderBoard(boardState);
      }
    }

    /**
     * Triggers confetti animation
     */
    function triggerConfetti() {
      const confettiInstance = new Confetti({
        resize: true,
        useWorker: true,
        resizeFromWindow: true
      });
      
      confettiInstance.start();
      setTimeout(() => confettiInstance.stop(), 3000);
    }
  </script>
</body>
</html>
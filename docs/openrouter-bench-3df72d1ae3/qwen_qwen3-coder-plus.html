<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* Smooth transitions for drag and drop */
        .kanban-card {
            transition: all 0.3s ease;
        }
        
        .kanban-column {
            transition: background-color 0.3s ease;
        }
        
        /* Dragging state */
        .kanban-card.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
        
        /* Drop target highlight */
        .kanban-column.drop-target {
            background-color: #dbeafe; /* blue-100 */
        }
        
        /* Editable input styling */
        .card-title-input {
            outline: none;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .card-title-input:focus {
            border-color: #3b82f6; /* blue-500 */
        }
        
        /* Custom scrollbar */
        .kanban-column-content {
            scrollbar-width: thin;
            scrollbar-color: #94a3b8 #e2e8f0;
        }
        
        .kanban-column-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .kanban-column-content::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 4px;
        }
        
        .kanban-column-content::-webkit-scrollbar-thumb {
            background-color: #94a3b8;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Kanban Board</h1>
            <p class="text-gray-600">Drag cards between columns to update their status</p>
        </header>

        <!-- Kanban Board -->
        <div id="kanban-board" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Columns will be generated by JavaScript -->
        </div>
    </div>

    <script>
        // Namespace for localStorage
        const STORAGE_KEY = 'kanban_board_data_v1';
        
        // Column definitions
        const COLUMNS = [
            { id: 'backlog', title: 'Backlog', color: 'bg-gray-200' },
            { id: 'in-progress', title: 'In Progress', color: 'bg-blue-200' },
            { id: 'review', title: 'Review', color: 'bg-yellow-200' },
            { id: 'done', title: 'Done', color: 'bg-green-200' }
        ];
        
        // Initial data structure
        let kanbanData = {
            backlog: [],
            'in-progress': [],
            review: [],
            done: []
        };
        
        // DOM Elements
        const kanbanBoard = document.getElementById('kanban-board');
        
        // Load data from localStorage or initialize with dummy data
        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                kanbanData = JSON.parse(savedData);
            } else {
                // Create dummy data if no data exists
                createDummyData();
                saveData();
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(kanbanData));
        }
        
        // Create dummy cards for initial state
        function createDummyData() {
            kanbanData.backlog = [
                { id: 'card-1', title: 'Research new UI trends' },
                { id: 'card-2', title: 'Plan marketing strategy' }
            ];
            
            kanbanData['in-progress'] = [
                { id: 'card-3', title: 'Implement user authentication' }
            ];
            
            kanbanData.review = [
                { id: 'card-4', title: 'Design system documentation' }
            ];
            
            kanbanData.done = [
                { id: 'card-5', title: 'Setup project repository' },
                { id: 'card-6', title: 'Create wireframes' }
            ];
        }
        
        // Generate unique ID for new cards
        function generateId() {
            return `card-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        }
        
        // Render the entire Kanban board
        function renderBoard() {
            kanbanBoard.innerHTML = '';
            
            COLUMNS.forEach(column => {
                const columnElement = document.createElement('div');
                columnElement.className = `kanban-column rounded-xl shadow-lg ${column.color} p-4 flex flex-col`;
                columnElement.dataset.columnId = column.id;
                
                // Column header
                const columnHeader = document.createElement('div');
                columnHeader.className = 'flex justify-between items-center mb-4';
                columnHeader.innerHTML = `
                    <h2 class="font-bold text-lg text-gray-800">${column.title}</h2>
                    <span class="bg-white bg-opacity-50 rounded-full px-3 py-1 text-sm font-medium">
                        ${kanbanData[column.id].length} cards
                    </span>
                `;
                
                // Add card button
                const addButton = document.createElement('button');
                addButton.className = 'add-card-btn mt-2 w-full py-2 bg-white bg-opacity-70 hover:bg-opacity-100 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center justify-center';
                addButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Add Card
                `;
                addButton.addEventListener('click', () => addCard(column.id));
                
                // Column content area
                const columnContent = document.createElement('div');
                columnContent.className = 'kanban-column-content flex-grow overflow-y-auto space-y-3 min-h-[100px] max-h-[calc(100vh-250px)]';
                
                // Render cards for this column
                kanbanData[column.id].forEach(card => {
                    const cardElement = createCardElement(card, column.id);
                    columnContent.appendChild(cardElement);
                });
                
                // Assemble column
                columnElement.appendChild(columnHeader);
                columnElement.appendChild(addButton);
                columnElement.appendChild(columnContent);
                
                kanbanBoard.appendChild(columnElement);
            });
        }
        
        // Create a card element
        function createCardElement(card, columnId) {
            const cardElement = document.createElement('div');
            cardElement.className = 'kanban-card bg-white rounded-lg shadow-md p-4 cursor-move hover:shadow-lg transition-shadow duration-200 relative group';
            cardElement.dataset.cardId = card.id;
            cardElement.dataset.columnId = columnId;
            cardElement.draggable = true;
            
            // Card content
            cardElement.innerHTML = `
                <div class="card-content">
                    <h3 class="card-title font-medium text-gray-800 break-words pr-6">${card.title}</h3>
                </div>
                <button class="delete-card absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </button>
            `;
            
            // Make card draggable
            cardElement.addEventListener('dragstart', handleDragStart);
            cardElement.addEventListener('dragend', handleDragEnd);
            
            // Enable editing on double click
            const titleElement = cardElement.querySelector('.card-title');
            titleElement.addEventListener('dblclick', () => enableEditing(titleElement, card.id, columnId));
            
            // Delete button functionality
            const deleteButton = cardElement.querySelector('.delete-card');
            deleteButton.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteCard(card.id, columnId);
            });
            
            return cardElement;
        }
        
        // Add a new card to a column
        function addCard(columnId) {
            const title = prompt('Enter card title:');
            if (title && title.trim() !== '') {
                const newCard = {
                    id: generateId(),
                    title: title.trim()
                };
                
                kanbanData[columnId].push(newCard);
                saveData();
                renderBoard();
            }
        }
        
        // Enable editing for a card title
        function enableEditing(titleElement, cardId, columnId) {
            const currentTitle = titleElement.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentTitle;
            input.className = 'card-title-input w-full bg-transparent font-medium';
            
            // Replace title with input
            titleElement.replaceWith(input);
            input.focus();
            
            // Handle saving changes
            const saveChanges = () => {
                const newTitle = input.value.trim();
                if (newTitle !== '') {
                    // Update data
                    const cardIndex = kanbanData[columnId].findIndex(c => c.id === cardId);
                    if (cardIndex !== -1) {
                        kanbanData[columnId][cardIndex].title = newTitle;
                        saveData();
                    }
                    
                    // Update UI
                    const newTitleElement = document.createElement('h3');
                    newTitleElement.className = 'card-title font-medium text-gray-800 break-words pr-6';
                    newTitleElement.textContent = newTitle;
                    input.replaceWith(newTitleElement);
                    
                    // Reattach event listener
                    newTitleElement.addEventListener('dblclick', () => enableEditing(newTitleElement, cardId, columnId));
                } else {
                    // If empty, revert to original
                    input.replaceWith(titleElement);
                }
            };
            
            // Save on Enter key or blur
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveChanges();
                }
            });
            
            input.addEventListener('blur', saveChanges);
        }
        
        // Delete a card with confirmation
        function deleteCard(cardId, columnId) {
            // Create custom confirmation modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Delete Card</h3>
                    <p class="text-gray-600 mb-6">Are you sure you want to delete this card? This action cannot be undone.</p>
                    <div class="flex justify-end space-x-3">
                        <button id="cancel-delete" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button id="confirm-delete" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            Delete
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle cancel
            document.getElementById('cancel-delete').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // Handle confirm
            document.getElementById('confirm-delete').addEventListener('click', () => {
                // Remove card from data
                kanbanData[columnId] = kanbanData[columnId].filter(card => card.id !== cardId);
                saveData();
                renderBoard();
                document.body.removeChild(modal);
            });
        }
        
        // Drag and Drop Functionality
        let draggedCard = null;
        
        function handleDragStart(e) {
            draggedCard = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }
        
        function handleDragEnd() {
            this.classList.remove('dragging');
            document.querySelectorAll('.kanban-column').forEach(col => {
                col.classList.remove('drop-target');
            });
            draggedCard = null;
        }
        
        // Initialize drag and drop events for columns
        function initDragAndDrop() {
            document.querySelectorAll('.kanban-column').forEach(column => {
                column.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drop-target');
                });
                
                column.addEventListener('dragleave', function() {
                    this.classList.remove('drop-target');
                });
                
                column.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drop-target');
                    
                    if (draggedCard) {
                        const targetColumnId = this.dataset.columnId;
                        const cardId = draggedCard.dataset.cardId;
                        const sourceColumnId = draggedCard.dataset.columnId;
                        
                        // Don't do anything if dropped in same column
                        if (sourceColumnId === targetColumnId) {
                            return;
                        }
                        
                        // Find and remove card from source column
                        const cardIndex = kanbanData[sourceColumnId].findIndex(c => c.id === cardId);
                        if (cardIndex !== -1) {
                            const [movedCard] = kanbanData[sourceColumnId].splice(cardIndex, 1);
                            
                            // Add card to target column
                            kanbanData[targetColumnId].push(movedCard);
                            
                            // Update card's column reference
                            movedCard.columnId = targetColumnId;
                            
                            // Save and re-render
                            saveData();
                            renderBoard();
                            
                            // Trigger confetti if moved to "Done"
                            if (targetColumnId === 'done') {
                                triggerConfetti();
                            }
                        }
                    }
                });
            });
        }
        
        // Trigger confetti animation
        function triggerConfetti() {
            const end = Date.now() + (15 * 100); // 1.5 seconds
            
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            (function frame() {
                confetti({
                    particleCount: 2,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors
                });
                
                confetti({
                    particleCount: 2,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors
                });
                
                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }
        
        // Initialize the application
        function init() {
            loadData();
            renderBoard();
            initDragAndDrop();
            
            // Re-initialize drag and drop after each render
            const observer = new MutationObserver(initDragAndDrop);
            observer.observe(kanbanBoard, { childList: true, subtree: true });
        }
        
        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- Tailwind CSS via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Simple confetti animation */
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        .confetti div {
            position: absolute;
            top: -10px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="kanban-board" class="container mx-auto p-4 mt-8">
        <div id="columns" class="flex space-x-4">
            <!-- Columns will be dynamically generated here -->
        </div>
    </div>

    <script>
        const namespace = 'kanban';
        const columns = ['Backlog', 'In Progress', 'Review', 'Done'];
        let boardData = JSON.parse(localStorage.getItem(namespace)) || {};

        // Initialize the board
        function initBoard() {
            if (Object.keys(boardData).length === 0) {
                // Create some dummy cards if no data exists
                boardData = {
                    Backlog: ['Task 1', 'Task 2'],
                    'In Progress': [],
                    Review: [],
                    Done: []
                };
            }

            columns.forEach(column => {
                const columnElement = document.createElement('div');
                columnElement.classList.add('w-1/4', 'bg-white', 'rounded-lg', 'shadow-md', 'p-4');
                columnElement.innerHTML = `
                    <h2 class="text-lg font-bold mb-2">${column}</h2>
                    <div id="${column.toLowerCase()}-cards" class="space-y-2"></div>
                    <button id="${column.toLowerCase()}-add" class="mt-4 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Add card</button>
                `;
                document.getElementById('columns').appendChild(columnElement);

                // Render cards
                boardData[column].forEach(cardText => addCard(column, cardText));

                // Add card functionality
                document.getElementById(`${column.toLowerCase()}-add`).addEventListener('click', () => {
                    const cardText = prompt('Enter new card text:');
                    if (cardText) {
                        addCard(column, cardText);
                    }
                });
            });

            // Enable drag and drop
            const draggable = document.querySelectorAll('.card');
            const droppableAreas = document.querySelectorAll('.column');

            draggable.forEach(card => {
                card.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', e.target.id);
                });
            });

            droppableAreas.forEach(area => {
                area.addEventListener('dragover', e => {
                    e.preventDefault();
                });

                area.addEventListener('drop', e => {
                    const cardId = e.dataTransfer.getData('text/plain');
                    const cardElement = document.getElementById(cardId);
                    const targetColumn = e.target.closest('.column').id.replace('-cards', '');

                    // Remove card from current column
                    const currentColumn = cardElement.parentElement.id.replace('-cards', '');
                    boardData[currentColumn] = boardData[currentColumn].filter(card => card !== cardElement.innerText);

                    // Add card to new column
                    boardData[targetColumn].push(cardElement.innerText);
                    area.appendChild(cardElement);

                    // Trigger confetti if moved to Done
                    if (targetColumn === 'Done') {
                        triggerConfetti();
                    }

                    // Save state
                    localStorage.setItem(namespace, JSON.stringify(boardData));
                });
            });
        }

        // Add a card to the board
        function addCard(column, cardText) {
            const cardElement = document.createElement('div');
            cardElement.id = `card-${Date.now()}`;
            cardElement.classList.add('card', 'bg-gray-200', 'p-3', 'rounded', 'cursor-pointer');
            cardElement.draggable = true;
            cardElement.innerText = cardText;

            // Editable in place
            let isEditing = false;
            cardElement.addEventListener('click', () => {
                if (isEditing) return;

                isEditing = true;
                const editText = cardElement.innerText;
                cardElement.innerHTML = `<input class="w-full" type="text" value="${editText}">`;
                const input = cardElement.querySelector('input');
                input.focus();
                input.addEventListener('blur', () => {
                    const newCardText = input.value.trim();
                    if (newCardText) {
                        cardElement.innerText = newCardText;
                        const currentColumn = cardElement.parentElement.id.replace('-cards', '');
                        boardData[currentColumn] = boardData[currentColumn].map(card => card === editText ? newCardText : card);
                        localStorage.setItem(namespace, JSON.stringify(boardData));
                    }
                    isEditing = false;
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        input.blur();
                    }
                });
            });

            // Deletable with confirmation
            cardElement.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                if (confirm(`Delete card "${cardText}"?`)) {
                    const currentColumn = cardElement.parentElement.id.replace('-cards', '');
                    boardData[currentColumn] = boardData[currentColumn].filter(card => card !== cardText);
                    cardElement.remove();
                    localStorage.setItem(namespace, JSON.stringify(boardData));
                }
            });

            document.getElementById(`${column.toLowerCase()}-cards`).appendChild(cardElement);
        }

        // Trigger confetti animation
        function triggerConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.classList.add('confetti');

            for (let i = 0; i < 100; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.style.left = `${Math.random() * 100}vw`;
                confettiPiece.style.animationDuration = `${(Math.random() * 3) + 2}s`;
                confettiContainer.appendChild(confettiPiece);
            }

            document.body.appendChild(confettiContainer);

            setTimeout(() => {
                confettiContainer.remove();
            }, 5000);
        }

        // Initialize the board on load
        initBoard();
    </script>
</body>
</html>
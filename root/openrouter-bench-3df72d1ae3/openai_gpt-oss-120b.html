<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vanilla JS Kanban Board</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Small confetti library (canvas‚Äëconfetti) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    /* Slight card lift on hover */
    .card:hover { transform: translateY(-2px); }
    /* Smooth transition for drag‚Äëover highlight */
    .column.drag-over { background-color: #f0f9ff; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

  <!-- Kanban board container -->
  <div id="board" class="w-full max-w-7xl grid grid-cols-1 md:grid-cols-4 gap-4">

    <!-- Columns will be generated by JavaScript -->
  </div>

  <!-- Delete confirmation modal (hidden by default) -->
  <div id="confirm-modal"
       class="fixed inset-0 bg-black/30 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-80">
      <p class="mb-4 text-gray-800">Delete this card?</p>
      <div class="flex justify-end space-x-2">
        <button id="confirm-no"
                class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">No</button>
        <button id="confirm-yes"
                class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Yes</button>
      </div>
    </div>
  </div>

  <script>
/* -------------------------------------------------------------
   Kanban Board ‚Äì vanilla JavaScript
   ------------------------------------------------------------- */

/* ---------- Configuration & constants ---------- */
const STORAGE_KEY = 'myKanbanBoard_v1';   // unique namespace for localStorage
const COLUMNS = [
  { id: 'backlog',    title: 'Backlog' },
  { id: 'inprogress',title: 'In Progress' },
  { id: 'review',    title: 'Review' },
  { id: 'done',      title: 'Done' }
];

/* ---------- Helper: generate unique IDs ---------- */
function uid() { return Date.now().toString(36) + Math.random().toString(36).substr(2); }

/* ---------- State handling (localStorage) ---------- */
let boardData = {};   // { columnId: [{id, content}] }

function loadBoard() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (raw) {
    boardData = JSON.parse(raw);
  } else {
    // No saved data ‚Üí create dummy cards
    boardData = {
      backlog: [
        { id: uid(), content: 'üì¶ Gather requirements' },
        { id: uid(), content: 'üß™ Set up test environment' }
      ],
      inprogress: [
        { id: uid(), content: '‚öôÔ∏è Implement drag‚Äëand‚Äëdrop' }
      ],
      review: [],
      done: [
        { id: uid(), content: '‚úÖ Initial project scaffold' }
      ]
    };
    saveBoard();
  }
}

function saveBoard() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(boardData));
}

/* ---------- Rendering ---------- */
const boardEl = document.getElementById('board');

function renderBoard() {
  boardEl.innerHTML = ''; // clear

  COLUMNS.forEach(col => {
    // Column container
    const colEl = document.createElement('div');
    colEl.className = 'column bg-white rounded-lg shadow p-4 flex flex-col';
    colEl.dataset.columnId = col.id;

    // Column header
    const header = document.createElement('h2');
    header.className = 'text-xl font-semibold mb-3 text-center';
    header.textContent = col.title;
    colEl.appendChild(header);

    // Cards container (flex‚Äëgrow)
    const cardsWrapper = document.createElement('div');
    cardsWrapper.className = 'cards flex-1 space-y-3';
    colEl.appendChild(cardsWrapper);

    // Render cards for this column
    (boardData[col.id] || []).forEach(card => {
      const cardEl = createCardElement(card);
      cardsWrapper.appendChild(cardEl);
    });

    // ‚ÄúAdd card‚Äù button
    const addBtn = document.createElement('button');
    addBtn.className = 'mt-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition';
    addBtn.textContent = '+ Add card';
    addBtn.addEventListener('click', () => showAddCardInput(col.id, cardsWrapper, addBtn));
    colEl.appendChild(addBtn);

    // Drag‚Äëover visual feedback
    colEl.addEventListener('dragover', e => {
      e.preventDefault(); // allow drop
      colEl.classList.add('drag-over');
    });
    colEl.addEventListener('dragleave', () => colEl.classList.remove('drag-over'));
    colEl.addEventListener('drop', e => handleDrop(e, col.id));

    boardEl.appendChild(colEl);
  });
}

/* ---------- Card creation ---------- */
function createCardElement(card) {
  const cardEl = document.createElement('div');
  cardEl.className = 'card bg-indigo-100 rounded p-2 shadow cursor-move transition transform';
  cardEl.draggable = true;
  cardEl.dataset.cardId = card.id;

  // Drag events
  cardEl.addEventListener('dragstart', e => {
    e.dataTransfer.setData('text/plain', JSON.stringify({
      cardId: card.id,
      fromColumn: cardEl.closest('.column').dataset.columnId
    }));
    // Slight opacity while dragging
    setTimeout(() => cardEl.classList.add('opacity-50'), 0);
  });
  cardEl.addEventListener('dragend', () => cardEl.classList.remove('opacity-50'));

  // Editable content (contenteditable)
  const contentEl = document.createElement('div');
  contentEl.className = 'card-content focus:outline-none';
  contentEl.contentEditable = true;
  contentEl.textContent = card.content;
  // Save changes on blur
  contentEl.addEventListener('blur', () => {
    const colId = cardEl.closest('.column').dataset.columnId;
    const cardObj = boardData[colId].find(c => c.id === card.id);
    if (cardObj) {
      cardObj.content = contentEl.textContent.trim() || 'Untitled';
      saveBoard();
    }
  });
  cardEl.appendChild(contentEl);

  // Delete button (small ‚Äú√ó‚Äù at top‚Äëright)
  const delBtn = document.createElement('button');
  delBtn.className = 'absolute right-1 top-1 text-gray-600 hover:text-red-600';
  delBtn.innerHTML = '&times;';
  delBtn.title = 'Delete card';
  delBtn.addEventListener('click', e => {
    e.stopPropagation(); // prevent drag start
    confirmDelete(card.id, cardEl.closest('.column').dataset.columnId);
  });
  // Positioning wrapper for delete button
  const wrapper = document.createElement('div');
  wrapper.className = 'relative';
  wrapper.appendChild(contentEl);
  wrapper.appendChild(delBtn);
  cardEl.innerHTML = ''; // clear previous children
  cardEl.appendChild(wrapper);

  return cardEl;
}

/* ---------- Add‚Äëcard UI ---------- */
function showAddCardInput(colId, wrapper, addBtn) {
  // Hide the ‚ÄúAdd card‚Äù button while input is visible
  addBtn.classList.add('hidden');

  // Input container
  const inputDiv = document.createElement('div');
  inputDiv.className = 'space-y-2';

  const textarea = document.createElement('textarea');
  textarea.className = 'w-full p-2 border rounded focus:outline-none focus:ring';
  textarea.rows = 3;
  textarea.placeholder = 'Card description...';
  inputDiv.appendChild(textarea);

  const actions = document.createElement('div');
  actions.className = 'flex justify-end space-x-2';

  const cancel = document.createElement('button');
  cancel.className = 'px-3 py-1 bg-gray-200 rounded hover:bg-gray-300';
  cancel.textContent = 'Cancel';
  cancel.addEventListener('click', () => {
    inputDiv.remove();
    addBtn.classList.remove('hidden');
  });

  const save = document.createElement('button');
  save.className = 'px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600';
  save.textContent = 'Save';
  save.addEventListener('click', () => {
    const txt = textarea.value.trim();
    if (txt) {
      const newCard = { id: uid(), content: txt };
      boardData[colId].push(newCard);
      saveBoard();
      wrapper.appendChild(createCardElement(newCard));
    }
    inputDiv.remove();
    addBtn.classList.remove('hidden');
  });

  actions.appendChild(cancel);
  actions.appendChild(save);
  inputDiv.appendChild(actions);
  wrapper.appendChild(inputDiv);
  textarea.focus();
}

/* ---------- Delete confirmation ---------- */
let pendingDelete = null; // { cardId, columnId }

function confirmDelete(cardId, columnId) {
  pendingDelete = { cardId, columnId };
  document.getElementById('confirm-modal').classList.remove('hidden');
}

document.getElementById('confirm-no').addEventListener('click', () => {
  pendingDelete = null;
  document.getElementById('confirm-modal').classList.add('hidden');
});

document.getElementById('confirm-yes').addEventListener('click', () => {
  if (pendingDelete) {
    const { cardId, columnId } = pendingDelete;
    boardData[columnId] = boardData[columnId].filter(c => c.id !== cardId);
    saveBoard();
    renderBoard(); // re‚Äërender to reflect deletion
    pendingDelete = null;
  }
  document.getElementById('confirm-modal').classList.add('hidden');
});

/* ---------- Drag‚Äëand‚Äëdrop handling ---------- */
function handleDrop(e, targetColumnId) {
  e.preventDefault();
  const colEl = e.currentTarget;
  colEl.classList.remove('drag-over');

  const data = e.dataTransfer.getData('text/plain');
  if (!data) return;
  const { cardId, fromColumn } = JSON.parse(data);
  if (fromColumn === targetColumnId) return; // no change

  // Find the card object
  const cardIdx = boardData[fromColumn].findIndex(c => c.id === cardId);
  if (cardIdx === -1) return;
  const [card] = boardData[fromColumn].splice(cardIdx, 1);
  boardData[targetColumnId].push(card);
  saveBoard();
  renderBoard();

  // If moved to ‚ÄúDone‚Äù, fire confetti
  if (targetColumnId === 'done') launchConfetti();
}

/* ---------- Confetti animation (canvas‚Äëconfetti) ---------- */
function launchConfetti() {
  const duration = 2 * 1000;
  const end = Date.now() + duration;

  (function frame() {
    // launch a few bursts
    confetti({
      particleCount: 30,
      spread: 70,
      origin: { y: 0.6 }
    });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

/* ---------- Initialise ---------- */
loadBoard();
renderBoard();
  </script>
</body>
</html>
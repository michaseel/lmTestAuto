<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Confetti library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* Custom styles and transitions */
        .kanban-column {
            transition: all 0.3s ease;
        }
        
        .kanban-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .kanban-card.dragging {
            opacity: 0.6;
            transform: scale(1.02);
        }
        
        .column-drop-zone {
            min-height: 100px;
            transition: background-color 0.2s ease;
        }
        
        .column-drop-zone.drag-over {
            background-color: rgba(167, 243, 208, 0.3);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600 mb-2">Kanban Board</h1>
            <p class="text-gray-600">Drag and drop cards between columns to organize your workflow</p>
        </header>
        
        <!-- Kanban Board -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6" id="kanban-board">
            <!-- Columns will be dynamically generated here -->
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
            <h3 class="text-xl font-semibold mb-4">Confirm Delete</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to delete this card? This action cannot be undone.</p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-delete" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancel</button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Delete</button>
            </div>
        </div>
    </div>
    
    <script>
        // Kanban Board Application
        (function() {
            // Constants for column names and localStorage key
            const COLUMNS = ['Backlog', 'In Progress', 'Review', 'Done'];
            const STORAGE_KEY = 'kanban_board_data';
            
            // State management
            let boardState = {
                Backlog: [],
                'In Progress': [],
                Review: [],
                Done: []
            };
            
            let currentCardToDelete = null;
            
            // DOM Elements
            const kanbanBoard = document.getElementById('kanban-board');
            const deleteModal = document.getElementById('delete-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            
            // Initialize the application
            function init() {
                loadState();
                renderBoard();
                setupEventListeners();
                
                // If no cards exist, create some dummy data
                if (Object.values(boardState).every(column => column.length === 0)) {
                    createDummyData();
                    saveState();
                    renderBoard();
                }
            }
            
            // Load state from localStorage
            function loadState() {
                const savedState = localStorage.getItem(STORAGE_KEY);
                if (savedState) {
                    try {
                        boardState = JSON.parse(savedState);
                    } catch (e) {
                        console.error('Error parsing saved state:', e);
                    }
                }
            }
            
            // Save state to localStorage
            function saveState() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(boardState));
            }
            
            // Create initial dummy data
            function createDummyData() {
                boardState.Backlog = [
                    { id: generateId(), content: 'Research new design trends' },
                    { id: generateId(), content: 'Update documentation' }
                ];
                
                boardState['In Progress'] = [
                    { id: generateId(), content: 'Implement user authentication' }
                ];
                
                boardState.Review = [
                    { id: generateId(), content: 'Code review for new API endpoints' }
                ];
                
                boardState.Done = [
                    { id: generateId(), content: 'Fix login page responsive issues' }
                ];
            }
            
            // Generate a unique ID for cards
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substring(2);
            }
            
            // Render the entire board
            function renderBoard() {
                kanbanBoard.innerHTML = '';
                
                COLUMNS.forEach(columnName => {
                    const column = createColumnElement(columnName);
                    kanbanBoard.appendChild(column);
                });
            }
            
            // Create a column element
            function createColumnElement(name) {
                const column = document.createElement('div');
                column.className = 'kanban-column bg-white rounded-lg shadow-md p-4 flex flex-col';
                column.dataset.column = name;
                
                // Column header
                const header = document.createElement('div');
                header.className = 'flex justify-between items-center mb-4 pb-2 border-b';
                
                const title = document.createElement('h2');
                title.className = 'text-xl font-semibold text-gray-800';
                title.textContent = name;
                
                const addButton = document.createElement('button');
                addButton.className = 'bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full transition-colors';
                addButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>';
                addButton.setAttribute('aria-label', `Add card to ${name}`);
                addButton.addEventListener('click', () => addCardToColumn(name));
                
                header.appendChild(title);
                header.appendChild(addButton);
                column.appendChild(header);
                
                // Cards container with drop zone
                const cardsContainer = document.createElement('div');
                cardsContainer.className = 'flex-1 column-drop-zone min-h-[100px]';
                cardsContainer.dataset.column = name;
                
                // Add existing cards
                boardState[name].forEach(cardData => {
                    const cardElement = createCardElement(cardData, name);
                    cardsContainer.appendChild(cardElement);
                });
                
                column.appendChild(cardsContainer);
                return column;
            }
            
            // Create a card element
            function createCardElement(cardData, columnName) {
                const card = document.createElement('div');
                card.className = 'kanban-card bg-white border border-gray-200 rounded-lg p-3 mb-3 shadow-sm cursor-grab fade-in';
                card.draggable = true;
                card.dataset.id = cardData.id;
                
                // Make card content editable
                const content = document.createElement('div');
                content.className = 'text-gray-800 mb-3 editable-content outline-none';
                content.contentEditable = true;
                content.textContent = cardData.content;
                
                // Save changes when content is edited
                content.addEventListener('blur', () => {
                    cardData.content = content.textContent;
                    saveState();
                });
                
                // Prevent Enter key from creating new lines, instead blur the element
                content.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        content.blur();
                    }
                });
                
                card.appendChild(content);
                
                // Delete button
                const deleteButton = document.createElement('button');
                deleteButton.className = 'text-red-500 hover:text-red-700 text-sm flex items-center';
                deleteButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Delete
                `;
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDeleteConfirmation(cardData.id, columnName);
                });
                
                card.appendChild(deleteButton);
                
                // Drag and drop event handlers
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', cardData.id);
                    card.classList.add('dragging');
                    setTimeout(() => {
                        card.style.display = 'none';
                    }, 0);
                });
                
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    card.style.display = 'block';
                    
                    // Remove drag-over class from all columns
                    document.querySelectorAll('.column-drop-zone').forEach(zone => {
                        zone.classList.remove('drag-over');
                    });
                });
                
                return card;
            }
            
            // Add a new card to a column
            function addCardToColumn(columnName) {
                const newCard = {
                    id: generateId(),
                    content: 'New task'
                };
                
                boardState[columnName].push(newCard);
                saveState();
                
                // Find the column and add the new card
                const columnElement = document.querySelector(`.column-drop-zone[data-column="${columnName}"]`);
                const cardElement = createCardElement(newCard, columnName);
                columnElement.appendChild(cardElement);
                
                // Focus on the content to allow immediate editing
                const contentElement = cardElement.querySelector('.editable-content');
                contentElement.focus();
                
                // Select all text for easy replacement
                const range = document.createRange();
                range.selectNodeContents(contentElement);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
            
            // Show delete confirmation modal
            function showDeleteConfirmation(cardId, columnName) {
                currentCardToDelete = { id: cardId, column: columnName };
                deleteModal.classList.remove('hidden');
            }
            
            // Hide delete confirmation modal
            function hideDeleteConfirmation() {
                deleteModal.classList.add('hidden');
                currentCardToDelete = null;
            }
            
            // Delete the current card
            function deleteCard() {
                if (!currentCardToDelete) return;
                
                const { id, column } = currentCardToDelete;
                
                // Remove from state
                boardState[column] = boardState[column].filter(card => card.id !== id);
                saveState();
                
                // Remove from DOM
                const cardElement = document.querySelector(`.kanban-card[data-id="${id}"]`);
                if (cardElement) {
                    cardElement.remove();
                }
                
                hideDeleteConfirmation();
            }
            
            // Handle drop events
            function handleDrop(e, columnName) {
                e.preventDefault();
                
                const cardId = e.dataTransfer.getData('text/plain');
                if (!cardId) return;
                
                // Find the card in the current state
                let cardData = null;
                let sourceColumn = null;
                
                for (const [colName, cards] of Object.entries(boardState)) {
                    const cardIndex = cards.findIndex(card => card.id === cardId);
                    if (cardIndex !== -1) {
                        cardData = cards[cardIndex];
                        sourceColumn = colName;
                        
                        // Remove from source column
                        boardState[colName].splice(cardIndex, 1);
                        break;
                    }
                }
                
                if (!cardData) return;
                
                // Add to target column
                boardState[columnName].push(cardData);
                saveState();
                
                // Remove from DOM in source column
                const sourceCardElement = document.querySelector(`.kanban-card[data-id="${cardId}"]`);
                if (sourceCardElement) {
                    sourceCardElement.remove();
                }
                
                // Add to DOM in target column
                const targetColumnElement = document.querySelector(`.column-drop-zone[data-column="${columnName}"]`);
                const newCardElement = createCardElement(cardData, columnName);
                targetColumnElement.appendChild(newCardElement);
                
                // If moving to Done column, trigger confetti
                if (columnName === 'Done') {
                    triggerConfetti();
                }
            }
            
            // Setup event listeners for drag and drop
            function setupEventListeners() {
                // Drop zones
                document.addEventListener('DOMContentLoaded', () => {
                    // Use event delegation for drop zones since they're dynamically created
                    document.addEventListener('dragover', (e) => {
                        e.preventDefault();
                    });
                    
                    document.addEventListener('drop', (e) => {
                        const dropZone = e.target.closest('.column-drop-zone');
                        if (dropZone) {
                            e.preventDefault();
                            const columnName = dropZone.dataset.column;
                            handleDrop(e, columnName);
                        }
                    });
                    
                    // Highlight drop zones when dragging over
                    document.addEventListener('dragenter', (e) => {
                        const dropZone = e.target.closest('.column-drop-zone');
                        if (dropZone) {
                            dropZone.classList.add('drag-over');
                        }
                    }, true);
                    
                    document.addEventListener('dragleave', (e) => {
                        const dropZone = e.target.closest('.column-drop-zone');
                        if (dropZone && !dropZone.contains(e.relatedTarget)) {
                            dropZone.classList.remove('drag-over');
                        }
                    }, true);
                });
                
                // Delete modal buttons
                cancelDeleteBtn.addEventListener('click', hideDeleteConfirmation);
                confirmDeleteBtn.addEventListener('click', deleteCard);
                
                // Close modal when clicking outside
                deleteModal.addEventListener('click', (e) => {
                    if (e.target === deleteModal) {
                        hideDeleteConfirmation();
                    }
                });
            }
            
            // Trigger confetti animation
            function triggerConfetti() {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff']
                });
            }
            
            // Initialize the application when the DOM is loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>
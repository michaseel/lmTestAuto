<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Custom styles for transitions and confetti */
        .card {
            transition: all 0.3s ease;
        }

        .card-dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f39c12; /* Change color for different confetti */
            transform: rotate(45deg);
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <!-- Kanban Board -->
    <div class="max-w-6xl mx-auto">
        <!-- Kanban Columns -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- Backlog Column -->
            <div>
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Backlog</h2>
                <div id="backlog" class="bg-white rounded-lg shadow p-4">
                    <!-- Dummy cards for initial state -->
                    <div class="flex gap-2 mb-4">
                        <div class="card p-3 bg-blue-100 text-blue-800 rounded">
                            <div class="text-sm font-medium">Card 1</div>
                        </div>
                        <div class="card p-3 bg-blue-100 text-blue-800 rounded">
                            <div class="text-sm font-medium">Card 2</div>
                        </div>
                    </div>
                    <div id="backlog-cards" class="space-y-3"></div>
                    <button id="add-backlog" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                        Add Card
                    </button>
                </div>
            </div>

            <!-- In Progress Column -->
            <div>
                <h2 class="text-xl font-semibold text-gray-700 mb-4">In Progress</h2>
                <div id="in-progress" class="bg-white rounded-lg shadow p-4">
                    <div id="in-progress-cards" class="space-y-3"></div>
                    <button id="add-in-progress" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                        Add Card
                    </button>
                </div>
            </div>

            <!-- Review Column -->
            <div>
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Review</h2>
                <div id="review" class="bg-white rounded-lg shadow p-4">
                    <div id="review-cards" class="space-y-3"></div>
                    <button id="add-review" class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded">
                        Add Card
                    </button>
                </div>
            </div>

            <!-- Done Column -->
            <div>
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Done</h2>
                <div id="done" class="bg-white rounded-lg shadow p-4">
                    <div id="done-cards" class="space-y-3"></div>
                    <button id="add-done" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                        Add Card
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Code -->
    <script>
        // Namespace for our Kanban board state
        const kanban = {
            columns: {
                backlog: [],
                'in-progress': [],
                review: [],
                done: []
            },

            // Initialize the Kanban board with dummy data if empty
            init: function() {
                this.loadState();
                if (this.columns.backlog.length === 0) {
                    this.addColumn('backlog', ['Card 1', 'Card 2']);
                }
                if (this.columns['in-progress'].length === 0) {
                    this.addColumn('in-progress', []);
                }
                if (this.columns.review.length === 0) {
                    this.addColumn('review', []);
                }
                if (this.columns.done.length === 0) {
                    this.addColumn('done', []);
                }
            },

            // Load saved state from localStorage
            loadState: function() {
                const savedState = JSON.parse(localStorage.getItem('kanban-board'));
                if (savedState) {
                    this.columns = savedState;
                }
            },

            // Save current state to localStorage
            saveState: function() {
                localStorage.setItem('kanban-board', JSON.stringify(this.columns));
            },

            // Add a new card to the specified column
            addColumn: function(columnId, cards = []) {
                this.columns[columnId] = cards;
                this.saveState();
            },

            // Add a new card to the specified column
            addCard: function(columnId, title) {
                const newCard = { id: Date.now(), title };
                this.columns[columnId].push(newCard);
                this.saveState();
            },

            // Remove a card from the specified column
            removeCard: function(columnId, cardId) {
                this.columns[columnId] = this.columns[columnId].filter(card => card.id !== cardId);
                this.saveState();
            },

            // Update a card's title in the specified column
            updateCard: function(columnId, cardId, newTitle) {
                const card = this.columns[columnId].find(card => card.id === cardId);
                if (card) {
                    card.title = newTitle;
                    this.saveState();
                }
            },

            // Render cards in a column
            renderCards: function(columnId, container) {
                container.innerHTML = '';
                this.columns[columnId].forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card p-3 rounded';
                    const editInput = document.createElement('input');
                    editInput.type = 'text';
                    editInput.value = card.title;
                    editInput.className = 'w-full p-2 border rounded';

                    cardElement.addEventListener('dblclick', () => {
                        const oldTitle = card.title;
                        editInput.value = oldTitle;
                        cardElement.innerHTML = '';
                        cardElement.appendChild(editInput);
                        editInput.focus();
                    });

                    cardElement.addEventListener('blur', () => {
                        if (editInput.value !== oldTitle) {
                            this.updateCard(columnId, card.id, editInput.value);
                        }
                        cardElement.innerHTML = '';
                        cardElement.appendChild(this.createCardElement(columnId, editInput.value));
                    });

                    cardElement.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            editInput.blur();
                        }
                    });

                    cardElement.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('card') && !e.target.classList.contains('input')) {
                            this.removeCard(columnId, card.id);
                        }
                    });

                    cardElement.appendChild(this.createCardElement(columnId, card.title));
                    container.appendChild(cardElement);
                });
            },

            // Create a card element for rendering
            createCardElement: function(columnId, title) {
                const cardElement = document.createElement('div');
                cardElement.className = 'flex justify-between items-center';
                const titleDiv = document.createElement('div');
                titleDiv.className = 'text-sm font-medium';
                titleDiv.textContent = title;
                cardElement.appendChild(titleDiv);
                const deleteButton = document.createElement('button');
                deleteButton.className = 'text-red-500 hover:text-red-700';
                deleteButton.innerHTML = '&times;';
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.removeCard(columnId, this.columns[columnId].findIndex(card => card.title === title));
                });
                cardElement.appendChild(deleteButton);
                return cardElement;
            },

            // Bind event listeners to all add buttons
            bindAddButtons: function() {
                document.getElementById('add-backlog').addEventListener('click', () => this.addColumn('backlog'));
                document.getElementById('add-in-progress').addEventListener('click', () => this.addColumn('in-progress'));
                document.getElementById('add-review').addEventListener('click', () => this.addColumn('review'));
                document.getElementById('add-done').addEventListener('click', () => this.addColumn('done'));
            },

            // Initialize the Kanban board
            initBoard: function() {
                this.renderCards('backlog', document.getElementById('backlog-cards'));
                this.renderCards('in-progress', document.getElementById('in-progress-cards'));
                this.renderCards('review', document.getElementById('review-cards'));
                this.renderCards('done', document.getElementById('done-cards'));
                this.bindAddButtons();
            }
        };

        // Initialize the Kanban board when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            kanban.init();
            kanban.initBoard();
        });
    </script>
</body>
</html>